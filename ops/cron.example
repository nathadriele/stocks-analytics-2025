# ============================================
# CRON EXAMPLES — Stock Market Analytics
# Copie trechos para seu crontab com: crontab -e
# ============================================
# Observações:
# - Ajuste caminhos absolutos conforme seu ambiente.
# - Redirecione logs para acompanhar execuções e erros.
# - Garanta que o fuso horário do sistema está correto.

# --------------------------------------------
# 1) Modo Docker Compose
#    Executa todos os dias às 19:30 (horário do servidor)
# --------------------------------------------
30 19 * * * cd /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025 && \
  /usr/bin/docker compose run --rm stocks-analytics >> /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025/logs/cron.log 2>&1

# Dica: para rebuild semanal (ex.: domingo 07:00), descomente:
# 0 7 * * 0 cd /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025 && \
#   /usr/bin/docker compose up --build --no-start && \
#   /usr/bin/docker compose run --rm stocks-analytics >> /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025/logs/cron-rebuild.log 2>&1

# --------------------------------------------
# 2) Modo Ambiente Local (venv)
#    Executa todos os dias às 19:30 (horário do servidor)
# --------------------------------------------
# Substitua /usr/bin/bash e os caminhos abaixo conforme seu SO:
30 19 * * * /usr/bin/bash -lc 'cd /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025 && \
  source .venv/bin/activate && \
  python -m src.app.run_daily_pipeline --retrain false --signal-col signal_cls --fee-bps 5 --slippage-bps 2 --skip-backtest false \
  >> /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025/logs/cron.log 2>&1'

# --------------------------------------------
# 3) Envio de e-mail (opcional) após pipeline
#    Executa às 19:45 (ajuste se necessário)
# --------------------------------------------
45 19 * * * /usr/bin/bash -lc 'cd /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025 && \
  source .venv/bin/activate && \
  python -m src.notify.email_report --subject "Daily Market Report — Stock Analytics" \
  >> /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025/logs/email.log 2>&1'

# --------------------------------------------
# 4) Rotação simples de logs (opcional) – diário 23:59
# --------------------------------------------
59 23 * * * /usr/bin/bash -lc 'cd /ABSOLUTE/PATH/TO/stocks-analytics-zoomcamp-2025/logs && \
  ts=$(date +\%Y-\%m-\%d_\%H-\%M-\%S) && \
  for f in *.log; do [ -f "$f" ] && mv "$f" "${f%.log}-$ts.log"; done'
